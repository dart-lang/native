# FFIgenPad

A web interface in which you paste a C header in a textbox on the left, and it outputs dart:ffi bindings generated by package:ffigen in a textbox on the right. (Inspiration is https://godbolt.org/ which does this for a C file on the left and assembly on the right.)

It doesn't need a server cause it compiles the Dart code in package:ffigen and libclang to WASM. That way everything can run in the browser.

------

## Project Structure

Most of the files in `lib/src` are copied from the source of *ffigen* with modifications to make it compatible with dart2wasm (many of the workarounds are listed in [this blog article](https://thecomputerm.hashnode.dev/dirty-deeds-done-dart-cheap-experiments-with-dart2wasm)).

However the files listed do not have an ffigen counterpart:
- [./lib/ffigenpad.dart](./lib/ffigenpad.dart)
- [./lib/memfs.dart](./lib/memfs.dart)
- [./lib/src/header_parser/calloc.dart](./lib/src/header_parser/calloc.dart)

- [./lib/src/header_parser/clang_bindings/clang_types.dart](./lib/src/header_parser/clang_bindings/clang_types.dart)
- [./lib/src/header_parser/clang_bindings/clang_wrapper.dart](./lib/src/header_parser/clang_bindings/clang_wrapper.dart)

## Building

### Prerequisites

- dart
- emscripten
- for website
  - nodejs
  - pnpm

### Steps

- Run `tool/setup.dart` to download LLVM archive files to build *libclang.wasm*

```sh
# in project root
dart run tool/setup.dart
```

- Run `tool/build_libclang.dart` to build *libclang.wasm* using functions exported from *third_party/libclang/libclang.exports*

```sh
# in project root
dart run tool/build_libclang.dart
```

- Build FFIgenPad using the experimental dart2wasm compiler

```sh
# in project root
dart compile wasm ./lib/ffigenpad.dart ./bin/ffigenpad.wasm \
    --extra-compiler-option=--enable-experimental-ffi \
    --extra-compiler-option=--enable-experimental-wasm-interop
```

- To build the website

```sh
# in project root
cd web
npm i # install dependencies
npm run build
# preview with: npm run preview
```
